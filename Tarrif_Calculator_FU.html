<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Water Bill Calculator</title>
    <style>
        
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --primary-light: #e0f2fe;
            --primary-gradient: linear-gradient(135deg, #0ea5e9, #38bdf8);
            --secondary: #0f172a;
            --text: #1e293b;
            --text-light: #64748b;
            --background: #f0f9ff;
            --background-alt: #e0f2fe;
            --card: #ffffff;
            --border: #bae6fd;
            --success: #10b981;
            --success-light: #d1fae5;
            --accent: #8b5cf6;
            --accent-light: #f3e8ff;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --shadow-sm: 0 2px 4px rgba(14, 165, 233, 0.06), 0 1px 2px rgba(14, 165, 233, 0.08);
            --shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.1), 0 2px 4px -1px rgba(14, 165, 233, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(14, 165, 233, 0.1), 0 4px 6px -2px rgba(14, 165, 233, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(14, 165, 233, 0.1), 0 10px 10px -5px rgba(14, 165, 233, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
           
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath fill='%230ea5e9' fill-opacity='0.05' d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z'%3E%3C/path%3E%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='250' viewBox='0 0 1080 900'%3E%3Cg fill-opacity='0.02'%3E%3Cpolygon fill='%23444' points='90 150 0 300 180 300'%3E%3C/polygon%3E%3Cpolygon points='90 150 180 0 0 0'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='270 150 360 0 180 0'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='450 150 360 300 540 300'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='450 150 540 0 360 0'%3E%3C/polygon%3E%3Cpolygon points='630 150 540 300 720 300'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='630 150 720 0 540 0'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='810 150 720 300 900 300'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='810 150 900 0 720 0'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='990 150 900 300 1080 300'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='990 150 1080 0 900 0'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='90 450 0 600 180 600'%3E%3C/polygon%3E%3Cpolygon points='90 450 180 300 0 300'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='270 450 180 600 360 600'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='270 450 360 300 180 300'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='450 450 360 600 540 600'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='450 450 540 300 360 300'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='630 450 540 600 720 600'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='630 450 720 300 540 300'%3E%3C/polygon%3E%3Cpolygon points='810 450 720 600 900 600'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='810 450 900 300 720 300'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='990 450 900 600 1080 600'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='990 450 1080 300 900 300'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='90 750 0 900 180 900'%3E%3C/polygon%3E%3Cpolygon points='270 750 180 900 360 900'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='270 750 360 600 180 600'%3E%3C/polygon%3E%3Cpolygon points='450 750 540 600 360 600'%3E%3C/polygon%3E%3Cpolygon points='630 750 540 900 720 900'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='630 750 720 600 540 600'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='810 750 720 900 900 900'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='810 750 900 600 720 600'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='990 750 900 900 1080 900'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='180 0 90 150 270 150'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='360 0 270 150 450 150'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='540 0 450 150 630 150'%3E%3C/polygon%3E%3Cpolygon points='900 0 810 150 990 150'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='0 300 -90 450 90 450'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='0 300 90 150 -90 150'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='180 300 90 450 270 450'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='180 300 270 150 90 150'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='360 300 270 450 450 450'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='360 300 450 150 270 150'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='540 300 450 450 630 450'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='540 300 630 150 450 150'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='720 300 630 450 810 450'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='720 300 810 150 630 150'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='900 300 810 450 990 450'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='900 300 990 150 810 150'%3E%3C/polygon%3E%3Cpolygon points='0 600 -90 750 90 750'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='0 600 90 450 -90 450'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='180 600 90 750 270 750'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='180 600 270 450 90 450'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='360 600 270 750 450 750'%3E%3C/polygon%3E%3Cpolygon fill='%23999' points='360 600 450 450 270 450'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='540 600 630 450 450 450'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='720 600 630 750 810 750'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='900 600 810 750 990 750'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='900 600 990 450 810 450'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='0 900 90 750 -90 750'%3E%3C/polygon%3E%3Cpolygon fill='%23444' points='180 900 270 750 90 750'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='360 900 450 750 270 750'%3E%3C/polygon%3E%3Cpolygon fill='%23AAA' points='540 900 630 750 450 750'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='720 900 810 750 630 750'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='900 900 990 750 810 750'%3E%3C/polygon%3E%3Cpolygon fill='%23222' points='1080 300 990 450 1170 450'%3E%3C/polygon%3E%3Cpolygon fill='%23FFF' points='1080 300 1170 150 990 150'%3E%3C/polygon%3E%3Cpolygon points='1080 600 990 750 1170 750'%3E%3C/polygon%3E%3Cpolygon fill='%23666' points='1080 600 1170 450 990 450'%3E%3C/polygon%3E%3Cpolygon fill='%23DDD' points='1080 900 1170 750 990 750'%3E%3C/polygon%3E%3C/g%3E%3C/svg%3E");
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            background: var(--primary-gradient);
            box-shadow: var(--shadow-lg);
        }

        .header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,224L48,208C96,192,192,160,288,165.3C384,171,480,213,576,240C672,267,768,277,864,250.7C960,224,1056,160,1152,144C1248,128,1344,160,1392,176L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            opacity: 0.8;
            z-index: 1;
        }

        .header h1 {
            font-size: 3rem;
            color: white;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            position: relative;
            z-index: 2;
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(14, 165, 233, 0.08);
            overflow: hidden;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .card:after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 8px;
            background: var(--primary-gradient);
            border-radius: 0 16px 16px 0;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            background: var(--primary-gradient);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .card-icon:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.1) 70%);
            top: 0;
            left: 0;
        }

        .card-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
            position: relative;
            z-index: 2;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 25px;
        }
        #flats-calculation-group {
            border: 1px dashed var(--primary-light);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 25px;
            background-color: var(--background-alt);
            display: none; 
        }
        #flats-calculation-group .form-group {
            margin-bottom: 15px; 
        }
        #flats-calculation-group .form-group:last-child {
            margin-bottom: 0;
        }
        .form-check {
            display: flex;
            align-items: center;
        }
        .form-check-input {
            width: 1.3em;
            height: 1.3em;
            margin-right: 10px;
            cursor: pointer;
            accent-color: var(--primary);
        }
        .form-check-label {
            cursor: pointer;
            font-weight: 500;
            color: var(--secondary);
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            font-size: 1rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            background-color: var(--card);
            color: var(--text);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15);
            background-color: rgba(255, 255, 255, 0.8);
        }

        .form-control:hover {
            border-color: var(--primary-light);
        }
        .form-control:disabled {
            background-color: var(--background-alt);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%231e293b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            color: white;
            background: var(--primary-gradient);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }

        .btn-primary:hover:before {
            left: 100%;
        }

        .btn-secondary {
            color: var(--secondary);
            background-color: var(--background-alt);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }


        .btn-block {
            display: block;
            width: 100%;
        }

        .error-message {
            color: var(--danger);
            background-color: var(--danger-light);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }

        .result-card {
            display: none;
        }

        .result-header {
            background: var(--primary-gradient);
            color: white;
            padding: 30px;
            border-radius: 16px 16px 0 0;
            margin: -30px -30px 30px -30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.1);
        }

        .result-header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,128L48,122.7C96,117,192,107,288,122.7C384,139,480,181,576,181.3C672,181,768,139,864,149.3C960,160,1056,224,1152,218.7C1248,213,1344,139,1392,101.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            opacity: 0.8;
            z-index: 1;
        }

        .result-title {
            font-size: 1.8rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 8px;
        }

        .result-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            font-weight: 300;
        }

        .info-group {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 20px;
        }

        .info-item {
            flex: 1;
            min-width: 200px;
            background-color: var(--primary-light);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(14, 165, 233, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .info-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .info-item:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-gradient);
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 8px;
            display: block;
            font-weight: 500;
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-shadow: 0 1px 1px rgba(255,255,255,0.8);
        }
        .info-value-small { 
             font-size: 1.1rem;
             font-weight: 500;
             color: var(--secondary);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
            margin: 30px 0 20px 0;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--border);
            position: relative;
            display: flex;
            align-items: center;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 80px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
            border-radius: 12px;
            overflow: hidden;
        }

        th, td {
            padding: 14px 18px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--primary-gradient);
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
            position: relative;
        }

        th:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.2);
        }

        tbody tr {
            transition: all 0.2s ease;
            background-color: var(--card);
        }

        tbody tr:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(14, 165, 233, 0.1);
            position: relative;
            z-index: 1;
        }

        .total-row {
            font-weight: 600;
            color: var(--secondary);
            background-color: var(--background);
        }

        .final-total {
            background-color: var(--success-light);
            color: var(--success);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 20px;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }

        .badge-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, var(--success), #34d399);
            color: white;
        }

        .badge-accent {
            background: linear-gradient(135deg, var(--accent), #a78bfa);
            color: white;
        }
         .badge-info {
             background: linear-gradient(135deg, #60a5fa, #3b82f6); 
             color: white;
         }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px 0;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            position: relative;
        }

        .footer:before {
            content: '';
            position: absolute;
            top: -5px;
            left: calc(50% - 100px);
            width: 200px;
            height: 10px;
            background: var(--primary-gradient);
            border-radius: 50%;
            filter: blur(3px);
        }

        /* --- Tips Section Styles --- */
        .tips-container .card-icon { /* Customizing icon for tips */
            background: var(--accent-light); /* A lighter, distinct background for the icon */
            border: 1px solid var(--accent); /* Border that matches accent color */
        }
        .tips-container .card-icon svg {
            fill: var(--accent); /* Icon color to match accent */
        }
        /* Remove the default right-side bar from the tips card */
        .tips-container::after {
            display: none;
        }

        .tip-item-collapsible {
            /* Spacing handled by card padding and internal margins/paddings */
        }
        .tip-item-collapsible:not(:last-child) {
             border-bottom: 1px solid var(--border); /* Separator line between tip items */
             margin-bottom: 15px; /* Space after the border before next tip header */
             padding-bottom: 15px; /* Space before the border */
        }
        
        .tip-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--secondary);
        }
        .tip-item-header strong {
            font-size: 1.05rem; 
            color: var(--primary-dark);
        }
        .tip-toggle-icon {
            color: var(--primary);
            transition: transform 0.2s ease-in-out;
            font-size: 1rem; 
            margin-left: 10px;
        }
        .tip-item-content {
            padding-top: 10px; /* Space from its header */
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .tip-item-content p {
            margin-bottom: 0;
        }
        .tip-item-collapsible.open .tip-toggle-icon {
            transform: rotate(90deg);
        }


        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }

            .result-header {
                margin: -20px -20px 20px -20px;
            }

            .info-item {
                min-width: 100%;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes waterRipple {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(0.95); opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        .animate-water {
            animation: waterRipple 4s ease-in-out infinite;
        }

        .loading {
            position: relative;
        }

        .loading:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                rgba(255,255,255, 0) 0%,
                rgba(255,255,255, 0.6) 50%,
                rgba(255,255,255, 0) 100%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
    </style>

<body>
    <div class="container">
         <div style="text-align: right; margin-bottom: 15px; position: relative; z-index: 10;">
            <label for="language-switcher" style="margin-right: 8px; font-weight: 500; color: var(--secondary);" data-translate-key="languageLabel">Language:</label>
            <select id="language-switcher" class="form-control form-select" style="display: inline-block; width: auto; padding: 8px 30px 8px 12px;">
                <option value="en">English</option>
                <option value="hi">हिन्दी (Hindi)</option>
                <option value="mr">मराठी (Marathi)</option>
            </select>
        </div>
        
        <div class="header">
            <h1 data-translate-key="headerTitle">Water Bill Calculator</h1>
            <p data-translate-key="headerSubtitle">Calculate your water bill based on consumption, category, and tap size</p>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-icon animate-water">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3.571c3.658 5.437 6 9.223 6 12.503 0 3.268-2.691 5.926-6 5.926s-6-2.658-6-5.925c0-3.281 2.341-7.067 6-12.504zm0-3.571c-4.87 7.197-8 11.699-8 16.075 0 4.378 3.579 7.925 8 7.925s8-3.547 8-7.925c0-4.376-3.13-8.878-8-16.075z"/></svg>
                </div>
                <h2 class="card-title" data-translate-key="inputDetailsTitle">Input Details</h2>
            </div>
            <div class="form-group">
                <label for="category" class="form-label" data-translate-key="categoryLabel">Category</label>
                <select id="category" class="form-control form-select">
                    <option value="R1" data-translate-key="catR1">R1 - Residential</option>
                    <option value="IA" data-translate-key="catIA">IA - Institutional A</option>
                    <option value="IB" data-translate-key="catIB">IB - Institutional B</option>
                    <option value="C1A" data-translate-key="catC1A">C1A - Commercial 1A</option>
                    <option value="C1B" data-translate-key="catC1B">C1B - Commercial 1B</option>
                    <option value="C2" data-translate-key="catC2">C2 - Commercial 2</option>
                    <option value="Slum Hut" data-translate-key="catSlumHut">Slum Hut</option>
                    <option value="Slum RCC" data-translate-key="catSlumRCC">Slum RCC</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tapSize" class="form-label" data-translate-key="tapSizeLabel">Tap Size (mm)</label>
                <select id="tapSize" class="form-control form-select">
                </select>
            </div>
            <div class="form-group">
                <label for="consumption" class="form-label" data-translate-key="consumptionLabel">Total Consumption (Units)</label>
                <input type="number" id="consumption" class="form-control" min="0" step="any" value="0" placeholder="Enter consumption" data-translate-key-placeholder="consumptionPlaceholder">
            </div>
            <div class="form-group">
                <label for="months" class="form-label" data-translate-key="monthsLabel">Billing Period (Months)</label>
                <input type="number" id="months" class="form-control" min="1" step="1" value="1">
            </div>

            <div id="flats-calculation-group">
                 <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="useFlats">
                    <label class="form-check-label" for="useFlats" data-translate-key="useFlatsLabel">
                        Residential Flats (If Appartment, For R1 Only)
                    </label>
                </div>
                 <div class="form-group">
                    <label for="numberOfFlats" class="form-label" data-translate-key="numberOfFlatsLabel">Number of Residential Flats</label>
                    <input type="number" id="numberOfFlats" class="form-control" min="1" step="1" value="1" disabled>
                 </div>
            </div>

            <button id="calculate" class="btn btn-primary btn-block">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="0.5" style="margin-right: 8px; vertical-align: -3px;"><path d="M12 3.571c3.658 5.437 6 9.223 6 12.503 0 3.268-2.691 5.926-6 5.926s-6-2.658-6-5.925c0-3.281 2.341-7.067 6-12.504zm0-3.571c-4.87 7.197-8 11.699-8 16.075 0 4.378 3.579 7.925 8 7.925s8-3.547 8-7.925c0-4.376-3.13-8.878-8-16.075z"/></svg>
                <span data-translate-key="calculateButton">Calculate Bill</span>
            </button>
            
            <div id="loading-indicator" style="display: none; text-align: center; margin-top: 20px;">
                 <div class="animate-water" style="display: inline-block; width: 60px; height: 60px;">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 100%; height: 100%; fill: var(--primary);"><path d="M12 3.571c3.658 5.437 6 9.223 6 12.503 0 3.268-2.691 5.926-6 5.926s-6-2.658-6-5.925c0-3.281 2.341-7.067 6-12.504zm0-3.571c-4.87 7.197-8 11.699-8 16.075 0 4.378 3.579 7.925 8 7.925s8-3.547 8-7.925c0-4.376-3.13-8.878-8-16.075z"/></svg>
                </div>
                <p style="color: var(--primary); margin-top: 10px; font-weight: 500;" data-translate-key="loadingText">Calculating your bill...</p>
            </div>
            <div id="error" class="error-message"></div>
        </div>

        <div class="card tips-container">
            <div class="card-header">
                <div class="card-icon">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--accent)" width="24" height="24">
                        <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                        <path d="M11 11h2v6h-2zm0-4h2v2h-2z"/>
                    </svg>
                </div>
                <h2 class="card-title" data-translate-key="tipsSectionTitleOverall">Helpful Tips</h2>
            </div>

            <div class="tip-item-collapsible">
                <div class="tip-item-header" data-toggle-tip="averageBillTipContent">
                    <strong data-translate-key="tipAverageBillLabel">Average Bill</strong>
                    <span class="tip-toggle-icon">▶</span>
                </div>
                <div class="tip-item-content" id="averageBillTipContent" style="display: none;">
                    <p data-translate-key="tipAverageBillDescription">If for some reason your premises' meter reading could not be collected, such as the house being locked, meter stopped, meter tampered with, meter buried in soil or concrete, or submerged in water, an Average Bill is considered in these conditions. This is based on your previous consumption.</p>
                </div>
            </div>
            <!-- Future tips can be added here as more .tip-item-collapsible blocks -->
        </div>


        <div id="result" class="card result-card">
            <div class="result-header">
                <h2 class="result-title" data-translate-key="resultsTitle">Bill Calculation Results</h2>
                <p class="result-subtitle" data-translate-key="resultsSubtitle">Detailed breakdown of your water bill</p>
            </div>
            <div id="result-content">
            </div>
        </div>

        <div class="footer">
            <span data-translate-key="footerText">Created By Mr. Pritam Chaudhary</span>
        </div>
    </div>

    <script>
        const tariffs = {
            "R1": { minUnit: 10, slabs: [{ range: "1-20", limit: 20, rate: 8.99 }, { range: "21-30", limit: 30, rate: 14.37 }, { range: "31-80", limit: 80, rate: 19.76 }, { range: "Above 80", limit: Infinity, rate: 26.95 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "IA": { minUnit: 10, slabs: [{ range: "1-20", limit: 20, rate: 23.34 }, { range: "21-80", limit: 80, rate: 26.95 }, { range: "Above 80", limit: Infinity, rate: 32.33 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "IB": { minUnit: 10, slabs: [{ range: "1-20", limit: 20, rate: 26.95 }, { range: "21-80", limit: 80, rate: 30.52 }, { range: "Above 80", limit: Infinity, rate: 35.93 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "C1A": { minUnit: 10, slabs: [{ range: "1-20", limit: 20, rate: 44.90 }, { range: "21-80", limit: 80, rate: 62.86 }, { range: "Above 80", limit: Infinity, rate: 80.79 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "C1B": { minUnit: 20, slabs: [{ range: "1-20", limit: 20, rate: 44.90 }, { range: "21-80", limit: 80, rate: 89.80 }, { range: "Above 80", limit: Infinity, rate: 134.69 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "C2": { minUnit: 10, slabs: [{ range: "1-30", limit: 30, rate: 107.76 }, { range: "31-100", limit: 100, rate: 323.26 }, { range: "Above 100", limit: Infinity, rate: 969.78 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "Slum Hut": { minUnit: 15, slabs: [{ range: "1-15", limit: 15, rate: 3.591 }, { range: "15-20", limit: 20, rate: 8.99 }, { range: "21-30", limit: 30, rate: 14.37 }, { range: "31-80", limit: 80, rate: 19.76 }, { range: "Above 80", limit: Infinity, rate: 26.95 }], surcharges: { electricity: 2.85, rawWater: 0.13 } },
            "Slum RCC": { minUnit: 20, slabs: [{ range: "1-20", limit: 20, rate: 4.495 }, { range: "21-30", limit: 30, rate: 14.37 }, { range: "31-80", limit: 80, rate: 19.76 }, { range: "Above 80", limit: Infinity, rate: 26.95 }], surcharges: { electricity: 2.85, rawWater: 0.13 } }
        };

        const minimumBills = {
            "R1": { "15": 89.80, "20": 179.59, "25": 323.26, "40": 915.9, "50": 1445.65, "80": 3196.62, "100": 4947.6, "150": 10604.53, "200": 18685.9, "250": 29056.94, "300": 41717.74 },
            "IA": { "15": 233.49, "20": 466.91, "25": 736.32, "40": 1544.46, "50": 2244.82, "80": 4345.97, "100": 6447.12, "150": 13235.48, "200": 22933.09, "250": 35378.35, "300": 50571.32 },
            "IB": { "15": 269.38, "20": 538.75, "25": 844.05, "40": 1759.93, "50": 2550.12, "80": 4884.73, "100": 7219.35, "150": 14761.93, "200": 25537.1, "250": 39365.19, "300": 56246.23 },
            "C1A": { "15": 448.96, "20": 897.93, "25": 1526.49, "40": 3412.12, "50": 5073.28, "80": 10326.19, "100": 15579.07, "150": 32549.9, "200": 56793.94, "250": 87907.18, "300": 125889.54 },
            "C1B": { "15": 448.96, "20": 897.93, "25": 1795.86, "40": 4489.64, "50": 6958.95, "80": 15713.73, "100": 24468.54, "150": 52753.3, "200": 93160.06, "250": 145015.4, "300": 208319.34 },
            "C2": { "15": 1077.5, "20": 2155.03, "25": 3232.56, "40": 12930.16, "50": 21011.51, "80": 74348.45, "100": 137383.02, "150": 341033.12, "200": 631961.83, "250": 1005320.4, "300": 1461108.71 },
            "Slum Hut": { "15": 53.87 }, 
            "Slum RCC": { "15": 89.80 }
        };

        function formatCurrency(value) {
            const numValue = typeof value === 'string' ? parseFloat(value) : value;
            if (isNaN(numValue)) return 'N/A';
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(numValue);
        }

        const categorySelect = document.getElementById('category');
        const tapSizeSelect = document.getElementById('tapSize');
        const consumptionInput = document.getElementById('consumption');
        const monthsInput = document.getElementById('months');
        const useFlatsCheckbox = document.getElementById('useFlats');
        const numberOfFlatsInput = document.getElementById('numberOfFlats');
        const flatsCalculationGroup = document.getElementById('flats-calculation-group');
        const calculateButton = document.getElementById('calculate');
        const errorElement = document.getElementById('error');
        const resultElement = document.getElementById('result');
        const resultContentElement = document.getElementById('result-content');
        const loadingIndicator = document.getElementById('loading-indicator');
        const languageSwitcher = document.getElementById('language-switcher');

        // --- TRANSLATION LOGIC ---
        const translations = {
            en: {
                pageTitle: "Water Bill Calculator",
                languageLabel: "Language:",
                headerTitle: "Water Bill Calculator",
                headerSubtitle: "Calculate your water bill based on consumption, category, and tap size",
                inputDetailsTitle: "Input Details",
                categoryLabel: "Category",
                catR1: "R1 - Residential",
                catIA: "IA - Institutional A",
                catIB: "IB - Institutional B",
                catC1A: "C1A - Commercial 1A",
                catC1B: "C1B - Commercial 1B",
                catC2: "C2 - Commercial 2",
                catSlumHut: "Slum Hut",
                catSlumRCC: "Slum RCC",
                tapSizeLabel: "Tap Size (mm)",
                consumptionLabel: "Total Consumption (Units)",
                consumptionPlaceholder: "Enter consumption",
                monthsLabel: "Billing Period (Months)",
                useFlatsLabel: "Residential Flats (If Appartment, For R1 Only)",
                numberOfFlatsLabel: "Number of Residential Flats",
                calculateButton: "Calculate Bill",
                loadingText: "Calculating your bill...",
                resultsTitle: "Bill Calculation Results",
                resultsSubtitle: "Detailed breakdown of your water bill",
                footerText: "Created By Mr. Pritam Chaudhary",
                errorInvalidInput: "Invalid input parameters...",
                errorFlatsNumber: "Number of flats must be 1 or more when 'Calculate per Flat' is enabled.",
                errorMinBillDataNotFound: "Minimum bill data not found for Category {category}, Tap Size {tapSize}mm.",
                errorInvalidConsumption: "Please enter a valid non-negative Total Consumption.",
                errorInvalidMonths: "Billing Period (Months) must be 1 or more.",
                errorInvalidTapSize: "Invalid tap size ({tapSize}mm) selected for category {category}. Please select a valid size.",
                errorSelectTapSize: "Please select a tap size for {category}.",
                errorFlatsInput: "Please enter a valid Number of Residential Flats (1 or more) when calculating per flat.",
                resultCategory: "Category",
                resultTapSize: "Tap Size",
                resultTotalConsumption: "Total Consumption",
                resultMonthlyAvgConsumption: "Monthly Avg. Consumption",
                resultBasis: "Basis",
                resultBillingPeriod: "Billing Period",
                resultSlabBreakdownTitle: "Slab-wise Breakdown (Monthly {basisType})",
                resultSlabRangeHeader: "Slab Range",
                resultRateHeader: "Rate",
                resultConsumptionInSlabHeader: "Consumption in Slab",
                resultAmountHeader: "Amount",
                resultCalcMonthlyBaseBill: "Calculated Monthly Base Bill ({basisTypeDetail})",
                resultMinBillApplied: "Minimum Bill Applied",
                resultMinBillSlumHut: " (Slum Hut Rule: Up to 15 Units)",
                resultMinBillSlumRCC: " (Slum RCC Rule: Up to 20 Units)",
                resultMinBillTapSize: " (for {tapSize}mm tap)",
                resultMinBillGeneric: " (Minimum Rule)",
                resultEffectiveMonthlyBill: "Effective Monthly Bill ({basisTypeDetail})",
                resultTotalBillCalcTitle: "Total Bill Calculation ({months} Month(s))",
                resultComponentHeader: "Component",
                resultCalculationHeader: "Calculation",
                resultTotalBaseBill: "Total Base Bill",
                resultElectricitySurcharge: "Electricity Surcharge",
                resultRawWaterSurcharge: "Raw Water Surcharge",
                resultFinalTotalBill: "Final Total Bill",
                resultResetButton: "Reset Inputs & Refresh",
                naTapSize: "N/A for this category",
                naSurchargeMinBill: "N/A (Min. Bill Applied)",
                basisTotal: "Total",
                basisPerFlat: "Per Flat ({numFlats} flats)",
                basisPerFlatSimple: "per Flat",
                basisPerConnection: "per Connection",
                tipsSectionTitleOverall: "Helpful Tips",
                tipAverageBillLabel: "Average Bill",
                tipAverageBillDescription: "If for some reason your premises' meter reading could not be collected, such as the house being locked, meter stopped, meter tampered with, meter buried in soil or concrete, or submerged in water, an Average Bill is considered in these conditions. This is based on your previous consumption."
            },
            hi: {
                pageTitle: "पानी बिल कैलकुलेटर",
                languageLabel: "भाषा:",
                headerTitle: "पानी बिल कैलकुलेटर",
                headerSubtitle: "खपत, श्रेणी और नल के आकार के आधार पर अपने पानी के बिल की गणना करें",
                inputDetailsTitle: "विवरण दर्ज करें",
                categoryLabel: "श्रेणी",
                catR1: "R1 - आवासीय",
                catIA: "IA - संस्थागत ए",
                catIB: "IB - संस्थागत बी",
                catC1A: "C1A - वाणिज्यिक 1ए",
                catC1B: "C1B - वाणिज्यिक 1बी",
                catC2: "C2 - वाणिज्यिक 2",
                catSlumHut: "झुग्गी झोपड़ी",
                catSlumRCC: "झुग्गी आरसीसी",
                tapSizeLabel: "नल का आकार (मिमी)",
                consumptionLabel: "कुल खपत (यूनिट)",
                consumptionPlaceholder: "खपत दर्ज करें",
                monthsLabel: "बिलिंग अवधि (महीने)",
                useFlatsLabel: "आवासीय फ्लैट (यदि अपार्टमेंट, केवल R1 के लिए)",
                numberOfFlatsLabel: "आवासीय फ्लैटों की संख्या",
                calculateButton: "बिल की गणना करें",
                loadingText: "आपके बिल की गणना हो रही है...",
                resultsTitle: "बिल गणना परिणाम",
                resultsSubtitle: "आपके पानी के बिल का विस्तृत विवरण",
                footerText: "श्री प्रीतम चौधरी द्वारा निर्मित",
                errorInvalidInput: "अमान्य इनपुट पैरामीटर...",
                errorFlatsNumber: "'प्रति फ्लैट गणना करें' सक्षम होने पर फ्लैटों की संख्या 1 या अधिक होनी चाहिए।",
                errorMinBillDataNotFound: "श्रेणी {category}, नल आकार {tapSize}मिमी के लिए न्यूनतम बिल डेटा नहीं मिला।",
                errorInvalidConsumption: "कृपया एक वैध गैर-नकारात्मक कुल खपत दर्ज करें।",
                errorInvalidMonths: "बिलिंग अवधि (महीने) 1 या अधिक होनी चाहिए।",
                errorInvalidTapSize: "श्रेणी {category} के लिए अमान्य नल आकार ({tapSize}मिमी) चुना गया। कृपया एक वैध आकार चुनें।",
                errorSelectTapSize: "कृपया {category} के लिए नल का आकार चुनें।",
                errorFlatsInput: "प्रति फ्लैट गणना करते समय कृपया आवासीय फ्लैटों की एक वैध संख्या (1 या अधिक) दर्ज करें।",
                resultCategory: "श्रेणी",
                resultTapSize: "नल का आकार",
                resultTotalConsumption: "कुल खपत",
                resultMonthlyAvgConsumption: "मासिक औसत खपत",
                resultBasis: "आधार",
                resultBillingPeriod: "बिलिंग अवधि",
                resultSlabBreakdownTitle: "स्लैब-वार ब्रेकडाउन (मासिक {basisType})",
                resultSlabRangeHeader: "स्लैब रेंज",
                resultRateHeader: "दर",
                resultConsumptionInSlabHeader: "स्लैब में खपत",
                resultAmountHeader: "राशि",
                resultCalcMonthlyBaseBill: "गणना की गई मासिक आधार बिल ({basisTypeDetail})",
                resultMinBillApplied: "न्यूनतम बिल लागू",
                resultMinBillSlumHut: " (झुग्गी झोपड़ी नियम: 15 यूनिट तक)",
                resultMinBillSlumRCC: " (झुग्गी आरसीसी नियम: 20 यूनिट तक)",
                resultMinBillTapSize: " ({tapSize}मिमी नल के लिए)",
                resultMinBillGeneric: " (न्यूनतम नियम)",
                resultEffectiveMonthlyBill: "प्रभावी मासिक बिल ({basisTypeDetail})",
                resultTotalBillCalcTitle: "कुल बिल गणना ({months} माह)",
                resultComponentHeader: "घटक",
                resultCalculationHeader: "गणना",
                resultTotalBaseBill: "कुल आधार बिल",
                resultElectricitySurcharge: "बिजली अधिभार",
                resultRawWaterSurcharge: "कच्चा पानी अधिभार",
                resultFinalTotalBill: "अंतिम कुल बिल",
                resultResetButton: "इनपुट रीसेट करें और रीफ्रेश करें",
                naTapSize: "इस श्रेणी के लिए लागू नहीं",
                naSurchargeMinBill: "लागू नहीं (न्यूनतम बिल लागू)",
                basisTotal: "कुल",
                basisPerFlat: "प्रति फ्लैट ({numFlats} फ्लैट)",
                basisPerConnection: "प्रति कनेक्शन",
                basisPerFlatSimple: "प्रति फ्लैट",
                tipsSectionTitleOverall: "उपयोगी सुझाव",
                tipAverageBillLabel: "औसत बिल",
                tipAverageBillDescription: "यदि किसी कारण से आपके परिसर का मीटर रीडिंग एकत्र नहीं किया जा सका, जैसे कि घर का ताला लगा होना, मीटर बंद होना, मीटर के साथ छेड़छाड़ होना, मीटर का मिट्टी या कंक्रीट में दबा होना, या पानी में डूबा होना, तो इन स्थितियों में एक औसत बिल माना जाता है। यह आपकी पिछली खपत पर आधारित होता है।"
            },
            mr: {
                pageTitle: "पाणी बिल कॅल्क्युलेटर",
                languageLabel: "भाषा:",
                headerTitle: "पाणी बिल कॅल्क्युलेटर",
                headerSubtitle: "वापर, श्रेणी आणि नळाच्या आकारावर आधारित आपले पाणी बिल मोजा",
                inputDetailsTitle: " तपशील प्रविष्ट करा",
                categoryLabel: "श्रेणी",
                catR1: "R1 - निवासी",
                catIA: "IA - संस्थात्मक ए",
                catIB: "IB - संस्थात्मक बी",
                catC1A: "C1A - व्यावसायिक 1ए",
                catC1B: "C1B - व्यावसायिक 1बी",
                catC2: "C2 - व्यावसायिक 2",
                catSlumHut: "झोपडपट्टीतील घर",
                catSlumRCC: "झोपडपट्टीतील आरसीसी घर",
                tapSizeLabel: "नळाचा आकार (मिमी)",
                consumptionLabel: "एकूण वापर (युनिट)",
                consumptionPlaceholder: "वापर प्रविष्ट करा",
                monthsLabel: "बिलिंग कालावधी (महिने)",
                useFlatsLabel: "निवासी फ्लॅट (अपार्टमेंट असल्यास, फक्त R1 साठी)",
                numberOfFlatsLabel: "निवासी फ्लॅट्सची संख्या",
                calculateButton: "बिल मोजा",
                loadingText: "तुमचे बिल मोजले जात आहे...",
                resultsTitle: "बिल गणना परिणाम",
                resultsSubtitle: "तुमच्या पाणी बिलाचा तपशीलवार तपशील",
                footerText: "श्री प्रीतम चौधरी यांनी तयार केले",
                errorInvalidInput: "अवैध इनपुट पॅरामीटर्स...",
                errorFlatsNumber: "'प्रति फ्लॅट गणना करा' सक्षम केल्यावर फ्लॅट्सची संख्या 1 किंवा अधिक असणे आवश्यक आहे.",
                errorMinBillDataNotFound: "श्रेणी {category}, नळ आकार {tapSize}मिमी साठी किमान बिल डेटा आढळला नाही.",
                errorInvalidConsumption: "कृपया वैध गैर-नकारात्मक एकूण वापर प्रविष्ट करा.",
                errorInvalidMonths: "बिलिंग कालावधी (महिने) 1 किंवा अधिक असणे आवश्यक आहे.",
                errorInvalidTapSize: "श्रेणी {category} साठी अवैध नळ आकार ({tapSize}मिमी) निवडला. कृपया वैध आकार निवडा.",
                errorSelectTapSize: "कृपया {category} साठी नळाचा आकार निवडा.",
                errorFlatsInput: "प्रति फ्लॅट गणना करताना कृपया निवासी फ्लॅट्सची वैध संख्या (1 किंवा अधिक) प्रविष्ट करा.",
                resultCategory: "श्रेणी",
                resultTapSize: "नळाचा आकार",
                resultTotalConsumption: "एकूण वापर",
                resultMonthlyAvgConsumption: "मासिक सरासरी वापर",
                resultBasis: "आधार",
                resultBillingPeriod: "बिलिंग कालावधी",
                resultSlabBreakdownTitle: "स्लॅब-निहाय ब्रेकडाउन (मासिक {basisType})",
                resultSlabRangeHeader: "स्लॅब श्रेणी",
                resultRateHeader: "दर",
                resultConsumptionInSlabHeader: "स्लॅबमधील वापर",
                resultAmountHeader: "रक्कम",
                resultCalcMonthlyBaseBill: "मोजलेले मासिक आधार बिल ({basisTypeDetail})",
                resultMinBillApplied: "किमान बिल लागू",
                resultMinBillSlumHut: " (झोपडपट्टीतील घर नियम: 15 युनिटपर्यंत)",
                resultMinBillSlumRCC: " (झोपडपट्टीतील आरसीसी घर नियम: 20 युनिटपर्यंत)",
                resultMinBillTapSize: " ({tapSize}मिमी नळासाठी)",
                resultMinBillGeneric: " (किमान नियम)",
                resultEffectiveMonthlyBill: "प्रभावी मासिक बिल ({basisTypeDetail})",
                resultTotalBillCalcTitle: "एकूण बिल गणना ({months} महिने)",
                resultComponentHeader: "घटक",
                resultCalculationHeader: "गणना",
                resultTotalBaseBill: "एकूण आधार बिल",
                resultElectricitySurcharge: "वीज अधिभार",
                resultRawWaterSurcharge: "कच्चे पाणी अधिभार",
                resultFinalTotalBill: "अंतिम एकूण बिल",
                resultResetButton: "इनपुट रीसेट करा आणि रिफ्रेश करा",
                naTapSize: "या श्रेणीसाठी लागू नाही",
                naSurchargeMinBill: "लागू नाही (किमान बिल लागू)",
                basisTotal: "एकूण",
                basisPerFlat: "प्रति फ्लॅट ({numFlats} फ्लॅट)",
                basisPerConnection: "प्रति कनेक्शन",
                basisPerFlatSimple: "प्रति फ्लॅट",
                tipsSectionTitleOverall: "उपयोगी सूचना",
                tipAverageBillLabel: "सरासरी बिल",
                tipAverageBillDescription: "जर काही कारणास्तव तुमच्या जागेचे मीटर रीडिंग गोळा करता आले नाही, जसे की घर कुलूपबंद असणे, मीटर बंद असणे, मीटरमध्ये छेडछाड करणे, मीटर मातीत किंवा काँक्रीटमध्ये गाडले जाणे, किंवा पाण्यात बुडणे, तर अशा परिस्थितीत सरासरी बिल विचारात घेतले जाते. हे तुमच्या मागील वापराच्या आधारावर असते."
            }
        };

        let currentLang = 'en'; 
        window.lastCalculationData = null;

        function translatePage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang; 
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (el.tagName === 'TITLE') { // Handle title tag separately
                        el.textContent = translations[lang][key];
                    } else {
                        el.textContent = translations[lang][key];
                    }
                }
            });
            // Translate placeholder specifically for consumption input
            const consumptionPlaceholderKey = consumptionInput.getAttribute('data-translate-key-placeholder');
            if (consumptionPlaceholderKey && translations[lang] && translations[lang][consumptionPlaceholderKey]) {
                consumptionInput.placeholder = translations[lang][consumptionPlaceholderKey];
            }


            categorySelect.querySelectorAll('option').forEach(option => {
                const key = option.getAttribute('data-translate-key');
                 if (translations[lang] && translations[lang][key]) {
                    option.textContent = translations[lang][key];
                }
            });
            // Update tap size dropdown if it shows "N/A"
            if (tapSizeSelect.options.length === 1 && tapSizeSelect.options[0].disabled) {
                tapSizeSelect.options[0].textContent = translateString('naTapSize');
            }


            if (resultElement.style.display === 'block' && window.lastCalculationData && !window.lastCalculationData.errorKey) {
                displayResults(window.lastCalculationData);
            } else if (resultElement.style.display === 'block' && window.lastCalculationData && window.lastCalculationData.errorKey) {
                // If an error was displayed, re-translate the error message
                errorElement.textContent = translateString(window.lastCalculationData.errorKey, window.lastCalculationData.errorPlaceholders || {});
            }
            // Re-translate loading text if it's visible (though unlikely to be needed if language changes while loading)
            if(loadingIndicator.style.display === 'block') {
                loadingIndicator.querySelector('p').textContent = translateString('loadingText');
            }
        }
        
        function translateString(key, replacements = {}) {
            let str = (translations[currentLang] && translations[currentLang][key]) ? translations[currentLang][key] : key;
            for (const placeholder in replacements) {
                str = str.replace(new RegExp(`{${placeholder}}`, 'g'), replacements[placeholder]);
            }
            return str;
        }


        languageSwitcher.addEventListener('change', (event) => {
            translatePage(event.target.value);
            localStorage.setItem('preferredLanguage', event.target.value);
        });

        document.addEventListener('DOMContentLoaded', () => {
            const preferredLang = localStorage.getItem('preferredLanguage');
            if (preferredLang && translations[preferredLang]) {
                languageSwitcher.value = preferredLang;
                translatePage(preferredLang);
            } else {
                translatePage('en'); 
            }
            categorySelect.dispatchEvent(new Event('change'));

            // --- Tips Toggle Logic ---
            document.querySelectorAll('[data-toggle-tip]').forEach(header => {
                header.addEventListener('click', function() {
                    const contentId = this.getAttribute('data-toggle-tip');
                    const contentElement = document.getElementById(contentId);
                    const parentItem = this.closest('.tip-item-collapsible');
                    
                    if (contentElement && parentItem) {
                        const isHidden = contentElement.style.display === 'none';
                        contentElement.style.display = isHidden ? 'block' : 'none';
                        
                        if (isHidden) {
                            parentItem.classList.add('open');
                        } else {
                            parentItem.classList.remove('open');
                        }
                    }
                });
            });
        });


        function calculateBill(category, totalConsumption, months, tapSize, useFlats, numberOfFlats) {
            if (!tariffs[category] || !minimumBills[category] || totalConsumption < 0 || months <= 0) {
                return { errorKey: "errorInvalidInput" };
            }
            if (useFlats && (isNaN(numberOfFlats) || numberOfFlats < 1)) {
                 return { errorKey: "errorFlatsNumber" };
            }

            const tariff = tariffs[category];
            const categoryMinimumBills = minimumBills[category];
            const baseMinimumBill = categoryMinimumBills ? categoryMinimumBills[tapSize] : undefined;

            if (baseMinimumBill === undefined && category !== "Slum Hut" && category !== "Slum RCC") {
                return { errorKey: "errorMinBillDataNotFound", errorPlaceholders: { category: category, tapSize: tapSize } };
            } else if (baseMinimumBill === undefined && (category === "Slum Hut" || category === "Slum RCC")) {
                 if (!tapSize) {
                     return { errorKey: "errorSelectTapSize", errorPlaceholders: { category: category } };
                 } else if (baseMinimumBill === undefined) { 
                     return { errorKey: "errorMinBillDataNotFound", errorPlaceholders: { category: category, tapSize: tapSize } };
                 }
            }

            let consumptionForSlabs;
            let calculationBasis = "Total"; 
            if (useFlats && category === "R1" && numberOfFlats > 0) {
                consumptionForSlabs = totalConsumption / numberOfFlats;
                calculationBasis = `Per Flat (${numberOfFlats} flats)`;
            } else {
                consumptionForSlabs = totalConsumption;
            }

            const monthlyConsumption = consumptionForSlabs / months; // This is monthly average per unit (flat/connection)
            let monthlyBaseBill = 0;
            let slabBreakdown = [];
            let remainingConsumption = monthlyConsumption;
            let previousLimit = 0;

            for (const slab of tariff.slabs) {
                const slabRange = slab.limit - previousLimit;
                const consumptionInSlab = Math.min(remainingConsumption, slabRange);
                if (consumptionInSlab > 0) {
                    const slabCost = consumptionInSlab * slab.rate;
                    monthlyBaseBill += slabCost;
                    slabBreakdown.push({ range: slab.range, rate: slab.rate, consumption: consumptionInSlab, cost: slabCost });
                    remainingConsumption -= consumptionInSlab;
                }
                if (remainingConsumption <= 0) break;
                previousLimit = slab.limit;
            }

            let effectiveMonthlyBillPerUnit; 
            let minimumBillApplied = false;
            let appliedMinimumBillValue = null;

            if (category === "Slum Hut") {
                const slumHutThreshold = 15; 
                const slumHutMinBill = 53.87; 
                if (monthlyConsumption < slumHutThreshold) {
                    effectiveMonthlyBillPerUnit = slumHutMinBill;
                    minimumBillApplied = true;
                    appliedMinimumBillValue = slumHutMinBill;
                } else { 
                    effectiveMonthlyBillPerUnit = Math.max(monthlyBaseBill, baseMinimumBill || 0); 
                    if (baseMinimumBill && monthlyBaseBill < baseMinimumBill) {
                        minimumBillApplied = true; 
                        appliedMinimumBillValue = baseMinimumBill;
                    } else {
                        minimumBillApplied = false; 
                    }
                }
            } else if (category === "Slum RCC") {
                const slumRccThreshold = 20;
                const slumRccMinBill = 89.80; 
                if (monthlyConsumption < slumRccThreshold) {
                    effectiveMonthlyBillPerUnit = slumRccMinBill;
                    minimumBillApplied = true;
                    appliedMinimumBillValue = slumRccMinBill;
                } else { 
                    effectiveMonthlyBillPerUnit = Math.max(monthlyBaseBill, baseMinimumBill || 0); 
                     if (baseMinimumBill && monthlyBaseBill < baseMinimumBill) {
                        minimumBillApplied = true; 
                        appliedMinimumBillValue = baseMinimumBill;
                    } else {
                        minimumBillApplied = false; 
                    }
                }
            } else { 
                effectiveMonthlyBillPerUnit = Math.max(monthlyBaseBill, baseMinimumBill || 0);
                if (baseMinimumBill && monthlyBaseBill < baseMinimumBill) {
                    minimumBillApplied = true;
                    appliedMinimumBillValue = baseMinimumBill;
                } else {
                     minimumBillApplied = false;
                }
            }

            let totalBillBeforeSurcharges;
            if (useFlats && category === "R1" && numberOfFlats > 0) {
                totalBillBeforeSurcharges = effectiveMonthlyBillPerUnit * numberOfFlats * months;
            } else {
                totalBillBeforeSurcharges = effectiveMonthlyBillPerUnit * months;
            }

            let electricitySurcharge = 0;
            let rawWaterSurcharge = 0;
            let surchargeableUnitsForCalc = 0; // Units on which surcharge will be calculated
            
            const isFixedSlumMinBillApplied = (
                (category === "Slum Hut" && appliedMinimumBillValue === 53.87 && monthlyConsumption < 15)
            );

            if (!isFixedSlumMinBillApplied) { // Surcharges apply only if not a fixed minimum bill case
                if (category === "Slum Hut") {
                    const slumHutSurchargeThresholdPerMonth = 15;
                    // For Slum Hut, `monthlyConsumption` is `totalConsumption / months` because it doesn't use flats logic here.
                    const totalThresholdUnitsOverPeriod = slumHutSurchargeThresholdPerMonth * months;

                    if (totalConsumption > totalThresholdUnitsOverPeriod) {
                        surchargeableUnitsForCalc = totalConsumption - totalThresholdUnitsOverPeriod;
                    } else {
                        surchargeableUnitsForCalc = 0; // No surcharge if total consumption is at or below the total threshold for the period
                    }
                } else {
                    // For all other categories (not Slum Hut)
                    surchargeableUnitsForCalc = totalConsumption;
                }
                
                electricitySurcharge = surchargeableUnitsForCalc * tariff.surcharges.electricity;
                rawWaterSurcharge = surchargeableUnitsForCalc * tariff.surcharges.rawWater;
            }
            // If isFixedSlumMinBillApplied is true, surcharges (and surchargeableUnitsForCalc) remain 0.


            const finalTotalBill = totalBillBeforeSurcharges + electricitySurcharge + rawWaterSurcharge;

            return {
                categoryDetails: { category, tapSize, minUnit: tariff.minUnit, minimumBill: baseMinimumBill },
                consumption: { total: totalConsumption, monthlyPerUnit: monthlyConsumption.toFixed(2), calculationBasis: calculationBasis, numberOfFlats: (useFlats && category === "R1" && numberOfFlats > 0) ? numberOfFlats : null },
                billing: { monthlyBaseBillPerUnit: monthlyBaseBill.toFixed(2), effectiveMonthlyBillPerUnit: effectiveMonthlyBillPerUnit.toFixed(2), minimumBillApplied, appliedMinimumBillValue, months, totalBillBeforeSurcharges: totalBillBeforeSurcharges.toFixed(2) },
                surcharges: { 
                    electricity: { rate: tariff.surcharges.electricity, amount: electricitySurcharge.toFixed(2) }, 
                    rawWater: { rate: tariff.surcharges.rawWater, amount: rawWaterSurcharge.toFixed(2) },
                    surchargeableUnits: surchargeableUnitsForCalc // Pass this for display
                },
                slabBreakdown, 
                finalTotalBill: finalTotalBill.toFixed(2),
                isFixedSlumMinBillApplied 
            };
        }

        function displayResults(result) {
            let basisText = result.consumption.calculationBasis === "Total" ? 
                translateString('basisTotal') : 
                translateString('basisPerFlat', {numFlats: result.consumption.numberOfFlats});

            let slabBreakdownTitleBasis = result.consumption.calculationBasis === 'Total' ? translateString('basisTotal') : translateString('basisPerFlatSimple');
            
            let basisTypeDetailText = result.consumption.calculationBasis === 'Total' ? translateString('basisPerConnection') : translateString('basisPerFlatSimple');


            let html = `
                <div class="info-group">
                    <div class="info-item"><div class="info-label">${translateString('resultCategory')}</div><div class="info-value">${result.categoryDetails.category}</div></div>
                    <div class="info-item"><div class="info-label">${translateString('resultTapSize')}</div><div class="info-value">${result.categoryDetails.tapSize || translateString('naTapSize')} mm</div></div>
                    <div class="info-item"><div class="info-label">${translateString('resultTotalConsumption')}</div><div class="info-value">${result.consumption.total} Units</div></div>
                     <div class="info-item">
                         <div class="info-label">${translateString('resultMonthlyAvgConsumption')}</div>
                         <div class="info-value">${result.consumption.monthlyPerUnit} Units</div>
                         <div class="info-value-small" style="margin-top: 5px;">${translateString('resultBasis')}: ${basisText}</div>
                     </div>
                    <div class="info-item"><div class="info-label">${translateString('resultBillingPeriod')}</div><div class="info-value">${result.billing.months} Month(s)</div></div>
                </div>

                <h3 class="section-title">${translateString('resultSlabBreakdownTitle', {basisType: slabBreakdownTitleBasis})}</h3>
                <table>
                    <thead><tr><th>${translateString('resultSlabRangeHeader')}</th><th>${translateString('resultRateHeader')}</th><th>${translateString('resultConsumptionInSlabHeader')}</th><th>${translateString('resultAmountHeader')}</th></tr></thead>
                    <tbody>`;

            result.slabBreakdown.forEach(slab => {
                html += `<tr><td><span class="badge badge-primary">${slab.range}</span></td><td>${formatCurrency(slab.rate)}</td><td>${slab.consumption.toFixed(2)} Units</td><td>${formatCurrency(slab.cost)}</td></tr>`;
            });

            html += `<tr class="total-row"><td colspan="3">${translateString('resultCalcMonthlyBaseBill', {basisTypeDetail: basisTypeDetailText})}</td><td>${formatCurrency(result.billing.monthlyBaseBillPerUnit)}</td></tr>`;

            if (result.billing.minimumBillApplied) {
                let minBillText = translateString('resultMinBillApplied');
                const monthlyAvgConsumptionNum = parseFloat(result.consumption.monthlyPerUnit);
                const appliedMinBillNum = parseFloat(result.billing.appliedMinimumBillValue);

                if (result.categoryDetails.category === "Slum Hut" && appliedMinBillNum === 53.87 && monthlyAvgConsumptionNum < 15) {
                   minBillText += translateString('resultMinBillSlumHut');
                } else if (result.categoryDetails.category === "Slum RCC" && appliedMinBillNum === 89.80 && monthlyAvgConsumptionNum < 20) {
                   minBillText += translateString('resultMinBillSlumRCC');
                } else if (result.categoryDetails.tapSize && result.billing.appliedMinimumBillValue === result.categoryDetails.minimumBill) { 
                   minBillText += translateString('resultMinBillTapSize', {tapSize: result.categoryDetails.tapSize});
                } else { 
                    minBillText += translateString('resultMinBillGeneric');
                }
                html += `
                    <tr>
                        <td colspan="3"><span class="badge badge-accent">${minBillText}</span></td>
                        <td>${formatCurrency(result.billing.appliedMinimumBillValue)}</td>
                    </tr>`;
            }

            html += `<tr class="total-row"><td colspan="3">${translateString('resultEffectiveMonthlyBill', {basisTypeDetail: basisTypeDetailText})}</td><td>${formatCurrency(result.billing.effectiveMonthlyBillPerUnit)}</td></tr>`;
            html += `</tbody></table>`;

            html += `<h3 class="section-title">${translateString('resultTotalBillCalcTitle', {months: result.billing.months})}</h3>
                <table>
                    <thead><tr><th>${translateString('resultComponentHeader')}</th><th>${translateString('resultCalculationHeader')}</th><th>${translateString('resultAmountHeader')}</th></tr></thead>
                    <tbody>`;
            let baseBillCalcText = `${formatCurrency(result.billing.effectiveMonthlyBillPerUnit)} × ${result.billing.months} month(s)`;
             if(result.consumption.calculationBasis !== 'Total' && result.consumption.numberOfFlats) {
                 baseBillCalcText = `(${formatCurrency(result.billing.effectiveMonthlyBillPerUnit)} per flat × ${result.consumption.numberOfFlats} flats) × ${result.billing.months} month(s)`;
             }
            html += `<tr><td>${translateString('resultTotalBaseBill')}</td><td>${baseBillCalcText}</td><td><strong>${formatCurrency(result.billing.totalBillBeforeSurcharges)}</strong></td></tr>`;
            
            let surchargeableUnitsForDisplay = result.surcharges.surchargeableUnits;
            let elecSurchargeCalc = result.isFixedSlumMinBillApplied ? 
                translateString('naSurchargeMinBill') : 
                `${formatCurrency(result.surcharges.electricity.rate)} × ${surchargeableUnitsForDisplay.toFixed(2)} units`;
            
            let rawWaterSurchargeCalc = result.isFixedSlumMinBillApplied ? 
                translateString('naSurchargeMinBill') : 
                `${formatCurrency(result.surcharges.rawWater.rate)} × ${surchargeableUnitsForDisplay.toFixed(2)} units`;


            html += `<tr><td>${translateString('resultElectricitySurcharge')}</td><td>${elecSurchargeCalc}</td><td>${formatCurrency(result.surcharges.electricity.amount)}</td></tr>
                     <tr><td>${translateString('resultRawWaterSurcharge')}</td><td>${rawWaterSurchargeCalc}</td><td>${formatCurrency(result.surcharges.rawWater.amount)}</td></tr>
                     <tr class="total-row final-total"><td colspan="2">${translateString('resultFinalTotalBill')}</td><td><span class="badge badge-success">${formatCurrency(result.finalTotalBill)}</span></td></tr>
                    </tbody>
                </table>`;
            
            html += `
                <button id="reset-results-button" class="btn btn-secondary btn-block" style="margin-top: 20px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0.5" style="margin-right: 8px; vertical-align: -3px;"> <path d="M2.5 2v6h6L12 4.5V6h8V2H2.5zM21.5 22h-6v-4l-3.5 3.5V20h-8v4h17.5z" opacity=".3"/><path d="M12 4.5L8.5 8h-6V2h10v2.5zM10 20.5l3.5-3.5h6V22H10v-1.5zM20 7H4v2h16V7zm0 8H4v2h16v-2z"/> <path d="M4 17.5A2.5 2.5 0 0 1 6.5 20H10v1.5L8.5 20H6.5A4.5 4.5 0 0 0 2 17.5v-11A4.5 4.5 0 0 0 6.5 2H10V.5L8.5 2H6.5A2.5 2.5 0 0 1 4 4.5v13zM20 6.5A2.5 2.5 0 0 1 17.5 4H14V2.5L15.5 4H17.5A4.5 4.5 0 0 0 22 6.5v11a4.5 4.5 0 0 0-4.5 4.5H14V24l1.5-1.5h2.5a2.5 2.5 0 0 1 2.5-2.5v-13z"/> </svg>
                    <span data-translate-key="resultResetButton">${translateString('resultResetButton')}</span>
                </button>
            `;

            setTimeout(() => {
                loadingIndicator.style.display = 'none';
                resultContentElement.innerHTML = html;
                resultElement.classList.remove('animate-fade-in');
                resultElement.style.display = 'block';
                resultElement.classList.add('animate-fade-in');
                resultElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 800); 
        }
        

        calculateButton.addEventListener('click', function() {
            const category = categorySelect.value;
            const tapSize = tapSizeSelect.value;
            const consumption = parseFloat(consumptionInput.value);
            const months = parseInt(monthsInput.value);
            const useFlats = useFlatsCheckbox.checked;
            const numberOfFlats = parseInt(numberOfFlatsInput.value);

            errorElement.textContent = ''; errorElement.style.display = 'none';
            resultElement.style.display = 'none'; loadingIndicator.style.display = 'block';
            loadingIndicator.querySelector('p').textContent = translateString('loadingText');


             if (isNaN(consumption) || consumption < 0) {
                 errorElement.textContent = translateString('errorInvalidConsumption');
                 errorElement.style.display = 'block'; loadingIndicator.style.display = 'none'; 
                 window.lastCalculationData = { errorKey: 'errorInvalidConsumption' }; 
                 return;
             }
             if (isNaN(months) || months < 1) {
                 errorElement.textContent = translateString('errorInvalidMonths');
                 errorElement.style.display = 'block'; loadingIndicator.style.display = 'none'; 
                 window.lastCalculationData = { errorKey: 'errorInvalidMonths' };
                 return;
             }
             if ((category !== "Slum Hut" && category !== "Slum RCC") && (!minimumBills[category] || minimumBills[category][tapSize] === undefined)) {
                 errorElement.textContent = translateString('errorInvalidTapSize', {tapSize: tapSize, category: category});
                 errorElement.style.display = 'block'; loadingIndicator.style.display = 'none'; 
                 window.lastCalculationData = { errorKey: 'errorInvalidTapSize', errorPlaceholders: {tapSize: tapSize, category: category} };
                 return;
             }
             if ((category === "Slum Hut" || category === "Slum RCC") && !tapSizeSelect.value) { 
                errorElement.textContent = translateString('errorSelectTapSize', {category: category});
                errorElement.style.display = 'block'; loadingIndicator.style.display = 'none'; 
                window.lastCalculationData = { errorKey: 'errorSelectTapSize', errorPlaceholders: {category: category} };
                return;
             }

             if (useFlats && (isNaN(numberOfFlats) || numberOfFlats < 1)) {
                 errorElement.textContent = translateString('errorFlatsInput');
                 errorElement.style.display = 'block'; loadingIndicator.style.display = 'none'; 
                 window.lastCalculationData = { errorKey: 'errorFlatsInput' };
                 return;
             }

            const result = calculateBill(category, consumption, months, tapSize, useFlats, numberOfFlats);
            window.lastCalculationData = result;

            if (result.errorKey) {
                errorElement.textContent = translateString(result.errorKey, result.errorPlaceholders || {});
                errorElement.style.display = 'block';
                loadingIndicator.style.display = 'none';
                return;
            }
            
            displayResults(result);
        });
        
        resultElement.addEventListener('click', function(event) {
            if (event.target.id === 'reset-results-button' || (event.target.closest && event.target.closest('#reset-results-button'))) {
                location.reload();
            }
        });

        categorySelect.addEventListener('change', function() {
            const selectedCategory = this.value;
            const currentTapSizeValue = tapSizeSelect.value; 
            let newSelectedValue = null;

            const validTapSizes = minimumBills[selectedCategory] ? Object.keys(minimumBills[selectedCategory]) : [];
            tapSizeSelect.innerHTML = ''; 

            if (validTapSizes.length > 0) {
                validTapSizes.forEach(size => {
                    const option = document.createElement('option');
                    option.value = size;
                    option.textContent = `${size} mm`; 
                    tapSizeSelect.appendChild(option);
                    if (size === currentTapSizeValue) {
                        newSelectedValue = size;
                    }
                });
                tapSizeSelect.value = newSelectedValue || validTapSizes[0]; 
                tapSizeSelect.disabled = false;
            } else {
                const option = document.createElement('option');
                option.value = ""; 
                option.textContent = translateString('naTapSize');
                option.disabled = true;
                tapSizeSelect.appendChild(option);
                tapSizeSelect.disabled = true;
            }

             if (selectedCategory === 'R1') {
                 flatsCalculationGroup.style.display = 'block';
                 useFlatsCheckbox.disabled = false;
             } else {
                 flatsCalculationGroup.style.display = 'none';
                 useFlatsCheckbox.checked = false;
                 useFlatsCheckbox.disabled = true;
                 numberOfFlatsInput.disabled = true; 
                 numberOfFlatsInput.value = '1'; 
             }
        });

         useFlatsCheckbox.addEventListener('change', function() {
             if (this.checked) {
                 numberOfFlatsInput.disabled = false;
                 numberOfFlatsInput.focus(); 
             } else {
                 numberOfFlatsInput.disabled = true;
                 numberOfFlatsInput.value = '1'; 
             }
         });

        numberOfFlatsInput.disabled = true;

    </script>
</body>
</html>
